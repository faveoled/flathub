app-id: io.github.faveoled.Portainer-Box
runtime: org.gnome.Platform
runtime-version: "47"
sdk: org.gnome.Sdk
command: run.sh
finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  - --filesystem=/var/run/docker.sock  
modules:

  - name: portainer
    buildsystem: simple
    build-commands:
      - mv portainer /app
    sources:
      - type: archive
        url: https://github.com/portainer/portainer/releases/download/2.21.4/portainer-2.21.4-linux-amd64.tar.gz
        dest: portainer
        sha256: 6addc5d42f0baae8f92a08add097f57fc19a29d196db68b1e60e3e6579c78b90
        only-arches:
          - x86_64

      - type: archive
        url: https://github.com/portainer/portainer/releases/download/2.21.4/portainer-2.21.4-linux-arm64.tar.gz
        dest: portainer
        sha256: e3d2705cc63a19caea8d7aa9032a31b1742c0302c7f2a50108d1bed54585bf49
        only-arches:
          - aarch64

  - name: portainer-box
    buildsystem: simple
    build-commands:
      - mkdir /app/portainer-box
      - mv portainer-box/*.js /app/portainer-box/

      - install -Dm755 run.sh /app/bin/run.sh
      - install -Dm644 portainer-box/${FLATPAK_ID}.png -t /app/share/icons/hicolor/512x512/apps/
      - install -Dm644 portainer-box/${FLATPAK_ID}.desktop -t /app/share/applications/
      - install -Dm644 portainer-box/${FLATPAK_ID}.metainfo.xml /app/share/metainfo/${FLATPAK_ID}.appdata.xml
    sources:
      - type: archive
        url: https://github.com/faveoled/portainer-box/archive/refs/tags/2.21.4-8.tar.gz
        sha256: 32f1a6d684696baf3e771b39593a2f6afe95dbe02deaaae3c0ac85704009709b
        dest: portainer-box

      - type: script
        commands:
          - gjs /app/portainer-box/main.js
        dest-filename: run.sh


